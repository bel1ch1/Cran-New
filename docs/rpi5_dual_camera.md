# Две камеры IMX219 на Raspberry Pi 5 (MIPI CSI)

Если `rpicam-vid --list-cameras` показывает только одну камеру, нужно явно прописать обе в конфиге загрузки.

**Важно:** Overlay `dtoverlay=imx219` **по умолчанию включает только порт CAM/DISP 1**. Если камера подключена к **CAM/DISP 0**, она не появится в системе, пока не указать **`cam0`**: `dtoverlay=imx219,cam0`. Это не поломка порта, а настройка.

## 1. Отключить автоопределение камер

Откройте конфиг (на Raspberry Pi OS Bookworm это обычно `/boot/firmware/config.txt`, на старых — `/boot/config.txt`):

```bash
sudo nano /boot/firmware/config.txt
```

Найдите строку `camera_auto_detect=1` и замените на:

```ini
camera_auto_detect=0
```

## 2. Добавить overlays для двух IMX219

В секции `[all]` (или в конце файла) добавьте **две отдельные строки**:

```ini
[all]
dtoverlay=imx219,cam0
dtoverlay=imx219
```

- **`dtoverlay=imx219,cam0`** — камера на порте **CAM/DISP 0** (без `cam0` этот порт не включается).
- **`dtoverlay=imx219`** — камера на порте **CAM/DISP 1** (значение по умолчанию для overlay).

Альтернативный вариант (если второй порт не подхватывается):

```ini
dtoverlay=imx219,cam0
dtoverlay=imx219,cam1
```

Сохраните файл (Ctrl+O, Enter, Ctrl+X) и перезагрузите:

```bash
sudo reboot
```

## 3. Проверить

После загрузки:

```bash
rpicam-vid --list-cameras
```

или:

```bash
libcamera-hello --list-cameras
```

Должны появиться две камеры (0 и 1) с разными путями (например разный `i2c@80000` и `i2c@88000`).

## 4. Подключение кабелей

- Разъёмы на Pi 5: **CAM/DISP0** (ближе к USB) и **CAM/DISP1** (ближе к разъёму питания).
- Контактная площадка кабеля должна быть обращена к разъёму Ethernet / контактам PoE.
- После смены конфига обязательно полное выключение питания и повторная вставка кабелей.

## 5. Если вторая камера всё равно не видна

1. **Логи ядра:**
   ```bash
   dmesg | grep -i imx
   ```

2. **Проверка I2C** (на RPi 5 шины могут быть 10, 11, 12, 13):
   ```bash
   i2cdetect -y 10
   i2cdetect -y 11
   ```
   Для IMX219 ожидается адрес 0x10 на одной из шин.

3. **Обновление системы:**
   ```bash
   sudo apt update && sudo apt full-upgrade
   ```

4. **Поменять камеры местами** — если после этого «переедет» та, что видна, проблема в порту или кабеле.

5. На некоторых платах с **двумя одинаковыми IMX219** вторая так и не определяется; тогда рассматривают мультиплексор (например Arducam) или одну камеру.

## 6. Переменные для приложения

Когда обе камеры появятся в `--list-cameras`, задайте пути из вывода:

```bash
export CRAN_CAMERA_BACKEND=rpi5_libcamera
export CRAN_BRIDGE_CAMERA_DEVICE="/base/axi/pcie@1000120000/rp1/i2c@80000/imx219@10"
export CRAN_HOOK_CAMERA_DEVICE="/base/axi/pcie@1000120000/rp1/i2c@88000/imx219@10"
```

(Подставьте фактические пути из вашего вывода.)
